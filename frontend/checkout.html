<!DOCTYPE html>
<html lang="en">
<head>
    <!-- <link rel="stylesheet" href="assets/css/common.css"> -->
     <style>
        :root {
  --primary-color: #ff69b4;
  --secondary-color: #333;
  --background-color: #000;
  --text-color: #fff;
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: var(--background-color);
  color: var(--text-color);
}

h1, h2 {
  color: var(--primary-color);
  font-weight: 700;
}

.checkout-section {
  background: rgba(15, 23, 42, 0.85);
  border-radius: 18px;
  padding: 30px;
  box-shadow: 0 10px 30px rgba(255,105,180,0.15);
  margin-bottom: 30px;
}

.form-control,
.form-select {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,105,180,0.25);
  color: #fff;
}

.form-control:focus,
.form-select:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 12px rgba(255,105,180,0.4);
  background: rgba(255,255,255,0.08);
}

.btn-primary {
  background-color: var(--primary-color);
  border-color: var(--primary-color);
  font-weight: 600;
}

.btn-primary:hover {
  background-color: #ff45a0;
  border-color: #ff45a0;
  transform: translateY(-2px);
}

     </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - EnerGise</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- (styles unchanged) -->
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="#">EnerGise</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Workouts</a></li>
                <li class="nav-item"><a class="nav-link" href="pricing.html">Pricing</a></li>
                <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
                <li class="nav-item"><a class="nav-link" href="login.html">Login</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5 pt-5">
    <h1 class="text-center mb-5">Checkout</h1>

    <div class="row">
        <!-- SHIPPING FORM -->
        <div class="col-md-8">
            <div class="checkout-section">
                <h2>Shipping Information</h2>
                <form id="checkoutForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">First Name</label>
                            <input id="firstName" class="form-control" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Last Name</label>
                            <input id="lastName" class="form-control" required>
                        </div>
                    </div>

                    <input id="address" class="form-control mb-2" placeholder="Address" required>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <input id="city" class="form-control" placeholder="City" required>
                        </div>
                        <div class="col-md-4">
                            <select id="state" class="form-select" required>
                                <option value="">State</option>
                                <option>Delhi</option>
                                <option>Haryana</option>
                                <option>Punjab</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <input id="zip" class="form-control" placeholder="ZIP" required>
                        </div>
                    </div>

                    <h2>Payment</h2>
                    <select id="paymentMethod" class="form-select mb-2" required>
                        <option value="">Select</option>
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                    </select>

                    <div id="cardDetails" style="display:none">
                        <input id="cardName" class="form-control mb-2" placeholder="Cardholder Name">
                        <input id="cardNumber" class="form-control mb-2" placeholder="Card Number">
                        <input id="cardExpiry" class="form-control mb-2" placeholder="MM/YY">
                        <input id="cardCvv" class="form-control mb-2" placeholder="CVV">
                    </div>
                </form>
            </div>
        </div>

        <!-- ORDER SUMMARY -->
        <div class="col-md-4">
            <div class="checkout-section">
                <h2>Order Summary</h2>
                <select id="productSelect" class="form-select mb-2"></select>
                <button id="addProduct" class="btn btn-primary mb-3">Add Product</button>

                <div id="cartItems"></div>
                <hr>
                <h5>Total: <span id="totalPrice">₹0.00</span></h5>
                <button id="placeOrderBtn" class="btn btn-primary w-100 mt-3">Place Order</button>
            </div>
        </div>
    </div>
</div>

<script>
/* ✅ AUTO BACKEND URL */
const API_BASE = window.location.origin;

document.addEventListener("DOMContentLoaded", () => {

    const payment = document.getElementById("paymentMethod");
    const cardBox = document.getElementById("cardDetails");
    payment.onchange = () => cardBox.style.display = payment.value === "card" ? "block" : "none";

    const products = [
        { name:"Dumbbells", price:750 },
        { name:"Yoga Mat", price:900 },
        { name:"Resistance Bands", price:300 }
    ];

    const productSelect = document.getElementById("productSelect");
    productSelect.innerHTML = `<option value="">Select</option>` +
        products.map(p=>`<option value="${p.name}" data-price="${p.price}">${p.name} - ₹${p.price}</option>`).join("");

    let cart = {};

    document.getElementById("addProduct").onclick = () => {
        const opt = productSelect.selectedOptions[0];
        if(!opt) return alert("Select product");
        const name = opt.value;
        const price = Number(opt.dataset.price);
        cart[name] = cart[name] || {price, qty:0};
        cart[name].qty++;
        renderCart();
    };

    function renderCart(){
        let total=0;
        const box=document.getElementById("cartItems");
        box.innerHTML="";
        Object.entries(cart).forEach(([k,v])=>{
            total+=v.price*v.qty;
            box.innerHTML+=`<div>${k} x${v.qty} - ₹${v.price*v.qty}</div>`;
        });
        document.getElementById("totalPrice").textContent="₹"+total;
    }

    document.getElementById("placeOrderBtn").onclick = async ()=>{
        if(!Object.keys(cart).length) return alert("Cart empty");

        const order={
            firstName:firstName.value,
            lastName:lastName.value,
            address:address.value,
            city:city.value,
            state:state.value,
            zip:zip.value,
            paymentMethod:payment.value,
            products:Object.entries(cart).map(([n,v])=>({name:n,price:v.price,quantity:v.qty}))
        };

        try{
            const res = await fetch(`${API_BASE}/api/orders`,{
                method:"POST",
                headers:{
                    "Content-Type":"application/json",
                    Authorization:`Bearer ${localStorage.getItem("token")||""}`
                },
                body:JSON.stringify(order)
            });
            const data = await res.json();
            if(res.ok){
                alert("✅ Order placed");
                location.href="index.html";
            } else {
                alert("❌ "+data.message);
            }
        }catch{
            alert("Server error");
        }
    };
});
</script>

</body>
</html>
