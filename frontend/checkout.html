<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Checkout - EnerGise</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #1a1f3c, #020617);
      color: #fff;
    }

    h1, h4 {
      color: #ff69b4;
      font-weight: 700;
    }

    .card-box {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 0 40px rgba(255,105,180,0.15);
    }

    .form-control, .form-select {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,105,180,0.4);
      color: #fff;
    }

    .form-control:focus, .form-select:focus {
      border-color: #ff69b4;
      box-shadow: 0 0 10px rgba(255,105,180,0.6);
      background: rgba(255,255,255,0.12);
      color: #fff;
    }

    .btn-primary {
      background: #ff69b4;
      border: none;
      font-weight: 600;
    }

    .btn-primary:hover {
      background: #ff45a0;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      color: #ddd;
    }

    hr {
      border-color: rgba(255,255,255,0.15);
    }
  </style>
</head>

<body>

<div class="container mt-5 mb-5">
  <h1 class="text-center mb-5">Checkout</h1>

  <div class="row g-4">

    <!-- SHIPPING -->
    <div class="col-md-7">
      <div class="card-box">
        <h4 class="mb-3">Shipping Information</h4>

        <input id="firstName" class="form-control mb-2" placeholder="First Name" required>
        <input id="lastName" class="form-control mb-2" placeholder="Last Name" required>
        <input id="address" class="form-control mb-2" placeholder="Address" required>

        <div class="row">
          <div class="col-md-6">
            <input id="city" class="form-control mb-2" placeholder="City" required>
          </div>
          <div class="col-md-4">
            <input id="state" class="form-control mb-2" placeholder="State" required>
          </div>
          <div class="col-md-2">
            <input id="zip" class="form-control mb-2" placeholder="ZIP" required>
          </div>
        </div>

        <h4 class="mt-4 mb-2">Payment</h4>
        <select id="paymentMethod" class="form-select">
          <option value="">Select</option>
          <option value="cash">Cash</option>
          <option value="card">Card</option>
        </select>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="col-md-5">
      <div class="card-box">
        <h4 class="mb-3">Order Summary</h4>

        <div id="cartItems"></div>

        <hr>
        <h5>Total: ₹<span id="totalPrice">0</span></h5>

        <button id="placeOrderBtn" class="btn btn-primary w-100 mt-3">
          Place Order
        </button>
      </div>
    </div>

  </div>
</div>

<script>
const API_BASE = window.location.origin;

/* ✅ Load cart from LocalStorage (ALL products) */
const cart = JSON.parse(localStorage.getItem("cart")) || [];

const cartBox = document.getElementById("cartItems");
let total = 0;

/* Render cart */
cart.forEach(item => {
  total += item.price * (item.quantity || 1);
  cartBox.innerHTML += `
    <div class="cart-item">
      <span>${item.name} x ${item.quantity || 1}</span>
      <span>₹${item.price * (item.quantity || 1)}</span>
    </div>
  `;
});

document.getElementById("totalPrice").textContent = total;

/* Place order */
document.getElementById("placeOrderBtn").onclick = async () => {

  if (!cart.length) {
    alert("Cart is empty");
    return;
  }

  const order = {
    firstName: firstName.value,
    lastName: lastName.value,
    address: address.value,
    city: city.value,
    state: state.value,
    zip: zip.value,
    paymentMethod: paymentMethod.value,
    products: cart,
    totalPrice: total
  };

  try {
    const res = await fetch(`${API_BASE}/api/orders`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer " + (localStorage.getItem("token") || "")
      },
      body: JSON.stringify(order)
    });

    const data = await res.json();

    if (res.ok) {
      alert("✅ Order placed successfully");
      localStorage.removeItem("cart");
      window.location.href = "index.html";
    } else {
      alert("❌ " + data.message);
    }
  } catch (err) {
    alert("Server error");
  }
};
</script>

</body>
</html>
