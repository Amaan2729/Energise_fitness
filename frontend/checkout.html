<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - EnerGise</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/checkout-theme.css">
</head>


<body>

<nav class="navbar navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand" href="#">EnerGise</a>
  </div>
</nav>

<div class="container mt-5 pt-5">
<h1 class="text-center mb-4">Checkout</h1>

<div class="row">
<div class="col-md-8">
<div class="checkout-section">
<h2>Shipping</h2>

<input id="firstName" class="form-control mb-2" placeholder="First Name" required>
<input id="lastName" class="form-control mb-2" placeholder="Last Name" required>
<input id="address" class="form-control mb-2" placeholder="Address" required>

<div class="row">
<div class="col-md-6"><input id="city" class="form-control mb-2" placeholder="City"></div>
<div class="col-md-4">
<select id="state" class="form-select mb-2">
<option>Delhi</option><option>Haryana</option><option>Punjab</option>
</select>
</div>
<div class="col-md-2"><input id="zip" class="form-control mb-2" placeholder="ZIP"></div>
</div>

<h2>Payment</h2>
<select id="paymentMethod" class="form-select mb-2">
<option value="">Select</option>
<option value="cash">Cash</option>
<option value="card">Card</option>
</select>

<div id="cardDetails" style="display:none">
<input class="form-control mb-2" placeholder="Card Name">
<input class="form-control mb-2" placeholder="Card Number">
</div>
</div>
</div>

<div class="col-md-4">
<div class="checkout-section">
<h2>Order</h2>

<select id="productSelect" class="form-select mb-2"></select>
<button id="addProduct" class="btn btn-primary mb-2">Add</button>

<div id="cartItems"></div>
<hr>
<h5>Total: <span id="totalPrice">₹0</span></h5>
<button id="placeOrderBtn" class="btn btn-primary w-100">Place Order</button>
</div>
</div>
</div>
</div>

<script>
const API_BASE = window.location.origin;

const products = [
  { name: "Dumbbells", price: 750 },
  { name: "Yoga Mat", price: 900 },
  { name: "Resistance Bands", price: 300 }
];

const sel = document.getElementById("productSelect");
sel.innerHTML =
  '<option value="">Select</option>' +
  products.map(p =>
    `<option value="${p.name}" data-price="${p.price}">
      ${p.name} - ₹${p.price}
    </option>`
  ).join("");

let cart = {};

document.getElementById("addProduct").onclick = () => {
  const opt = sel.selectedOptions[0];
  if (!opt) return alert("Select product");

  const name = opt.value;
  const price = Number(opt.dataset.price);

  cart[name] = cart[name] || { price, qty: 0 };
  cart[name].qty++;

  renderCart();
};

function renderCart() {
  let total = 0;
  const box = document.getElementById("cartItems");
  box.innerHTML = "";

  Object.entries(cart).forEach(([name, v]) => {
    const sum = v.price * v.qty;
    total += sum;
    box.innerHTML += `<div>${name} x ${v.qty} — ₹${sum}</div>`;
  });

  document.getElementById("totalPrice").textContent = "₹" + total;
  return total;
}

paymentMethod.onchange = () => {
  cardDetails.style.display = paymentMethod.value === "card" ? "block" : "none";
};

document.getElementById("placeOrderBtn").onclick = async () => {
  if (!Object.keys(cart).length) return alert("Cart empty");

  const totalPrice = renderCart();

  const orderPayload = {
    firstName: firstName.value,
    lastName: lastName.value,
    address: address.value,
    city: city.value,
    state: state.value,
    zip: zip.value,
    paymentMethod: paymentMethod.value,
    totalPrice,
    products: Object.entries(cart).map(([name, v]) => ({
      name,
      price: v.price,
      quantity: v.qty
    }))
  };

  const res = await fetch(`${API_BASE}/api/orders`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + localStorage.getItem("token")
    },
    body: JSON.stringify(orderPayload)
  });

  const data = await res.json();

  if (res.ok) {
    alert("✅ Order placed");
    location.href = "index.html";
  } else {
    alert("❌ " + data.message);
  }
};
</script>


</body>
</html>
